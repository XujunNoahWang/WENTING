# 需求文档

## 介绍

用户关联功能允许已注册的应用用户(app_users)与他们管理的被监管用户建立同步数据连接。此功能使已注册账户的家庭成员能够直接接收通知并同步管理他们的个人健康任务数据，消除了家庭成员之间手动提醒的需要。

## 需求

### 需求 1

**用户故事：** 作为家庭管理员（如妈妈），我希望将被监管用户档案关联到已注册家庭成员的账户，以便他们能够直接接收通知并管理自己的健康任务。

#### 验收标准

1. 当管理员选择被监管用户档案时，系统应显示supervised_user字段用于输入app_user用户名
2. 当管理员在supervised_user字段中输入有效的app_user用户名时，系统应启用关联按钮
3. 当管理员点击关联按钮时，系统应向目标app_user发送关联请求通知
4. 如果目标app_user不存在，系统应显示错误消息

### 需求 2

**用户故事：** 作为接收关联请求的注册用户，我希望能够确认或拒绝关联请求，以便控制我连接到哪些被监管用户档案。

#### 验收标准

1. 当收到关联请求时，系统应显示包含被监管用户详细信息的确认对话框
2. 当用户点击确认时，系统应建立关联关系
3. 当用户点击拒绝时，系统应拒绝关联请求并通知请求的管理员
4. 当关联被确认时，系统应将所有被监管用户数据同步到关联的app_user数据库中

### 需求 3

**用户故事：** 作为已关联用户，我希望我对被监管用户数据的操作能与管理员的视图同步，以便双方拥有一致的信息。

#### 验收标准

1. 当关联用户完成待办事项时，系统应在管理员的数据库中更新待办状态
2. 当管理员更新被监管用户数据时，系统应将更改同步到关联用户的数据库
3. 当任一方为被监管用户创建新的待办事项或笔记时，系统应将新数据同步到两个数据库
4. 如果同步失败，系统应重试并记录错误

### 需求 4

**用户故事：** 作为管理员，我希望访问关联管理界面，以便发起和管理被监管用户的关联关系。

#### 验收标准

1. 当访问关联页面时，系统应在顶部显示天气信息
2. 在关联页面上，系统应在左侧显示被监管用户列表
3. 当选择被监管用户时，系统应在右侧显示其信息
4. 当查看被监管用户信息时，系统应包含所有现有字段以及supervised_user字段
5. 当supervised_user字段被填充时，系统应显示关联按钮

### 需求 5

**用户故事：** 作为已关联用户，我希望接收我的被监管用户任务通知，以便独立管理我的健康活动。

#### 验收标准

1. 当已关联被监管用户的待办提醒时间到达时，系统应向管理员和关联用户发送通知
2. 当关联用户收到通知时，系统应清楚标识任务属于哪个被监管用户
3. 当关联用户完成任务时，系统应为两个用户更新完成状态
4. 如果用户当前未关联，系统应仅向管理员发送通知

### 需求 6

**用户故事：** 作为系统管理员，我希望确保关联操作期间的数据完整性，以便在同步过程中不会丢失或损坏数据。

#### 验收标准

1. 当建立关联时，系统应在关联用户的数据库中创建被监管用户数据的完整副本
2. 当同步数据时，系统应维护相关记录之间的引用完整性
3. 当建立关联时，系统应保留所有现有的待办事项和笔记数据
4. 如果同步遇到冲突，系统应使用基于时间戳的解决方案，最近的更改优先